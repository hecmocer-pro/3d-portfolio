!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("THREE")):"function"==typeof define&&define.amd?define(["THREE"],e):"object"==typeof exports?exports.ENABLE3D=e(require("THREE")):t.ENABLE3D=e(t.THREE)}(window,(function(t){return function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=14)}([function(e,o){e.exports=t},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){console.error("%c [enable3d] "+t+" ","background: #222; color: #bada55")}},function(t,e,o){"use strict";
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(0),s=function(t){function e(){var e=t.call(this)||this;return e.vector3=new i.Vector3,e.isGroup=!1,e.hasBody=!1,e.anims={},e._currentAnimation="",e._animationActions=new Map,e.name="object-"+e.id,e}return r(e,t),e.prototype.setAction=function(t){console.warn("[enable3d] setAction(name) is deprecated. Use animation.play(name) instead!"),this.animationPlay(t)},Object.defineProperty(e.prototype,"world",{get:function(){return{theta:this.worldTheta,phi:this.worldPhi}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldTheta",{get:function(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldPhi",{get:function(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animation",{get:function(){var t=this;return{current:this._currentAnimation,add:function(e,o){return t.animationAdd(e,o)},play:function(e,o,n){return void 0===o&&(o=500),void 0===n&&(n=!0),t.animationPlay(e,o,n)},mixer:this.animationMixer}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationMixer",{get:function(){return this._animationMixer||(this._animationMixer=new i.AnimationMixer(this)),this._animationMixer},set:function(t){this._animationMixer=t},enumerable:!0,configurable:!0}),e.prototype.animationAdd=function(t,e){this._animationActions.set(t,this.animationMixer.clipAction(e))},e.prototype.animationPlay=function(t,e,o){void 0===e&&(e=500),void 0===o&&(o=!0);var n=this._animationActions.get(t),r=this._animationActions.get(this._currentAnimation);n&&(n.reset(),r&&(n.crossFadeFrom(r,e/1e3,!0),n.clampWhenFinished=!0),o||n.setLoop(i.LoopOnce,0),n.play()),this._currentAnimation=t},e}(i.Object3D);e.ExtendedObject3D=s,e.default=s},function(t,e,o){"use strict";
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(0),s=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.vector3=new i.Vector3,n.isGroup=!1,n.hasBody=!1,n.name="object-"+n.id,n}return r(e,t),Object.defineProperty(e.prototype,"world",{get:function(){return{theta:this.worldTheta,phi:this.worldPhi}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldTheta",{get:function(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldPhi",{get:function(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)},enumerable:!0,configurable:!0}),e}(i.Mesh);e.ExtendedMesh=s},function(t,e,o){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function i(){}function s(t,e,o){this.fn=t,this.context=e,this.once=o||!1}function a(t,e,o,n,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var a=new s(o,n||t,i),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),u.prototype.eventNames=function(){var t,e,o=[];if(0===this._eventsCount)return o;for(e in t=this._events)n.call(t,e)&&o.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},u.prototype.listeners=function(t){var e=r?r+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,i=o.length,s=new Array(i);n<i;n++)s[n]=o[n].fn;return s},u.prototype.listenerCount=function(t){var e=r?r+t:t,o=this._events[e];return o?o.fn?1:o.length:0},u.prototype.emit=function(t,e,o,n,i,s){var a=r?r+t:t;if(!this._events[a])return!1;var c,u,l=this._events[a],m=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),m){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,o),!0;case 4:return l.fn.call(l.context,e,o,n),!0;case 5:return l.fn.call(l.context,e,o,n,i),!0;case 6:return l.fn.call(l.context,e,o,n,i,s),!0}for(u=1,c=new Array(m-1);u<m;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),m){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,o);break;case 4:l[u].fn.call(l[u].context,e,o,n);break;default:if(!c)for(d=1,c=new Array(m-1);d<m;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(t,e,o){return a(this,t,e,o,!1)},u.prototype.once=function(t,e,o){return a(this,t,e,o,!0)},u.prototype.removeListener=function(t,e,o,n){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==e||n&&!s.once||o&&s.context!==o||c(this,i);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==e||n&&!s[a].once||o&&s[a].context!==o)&&u.push(s[a]);u.length?this._events[i]=1===u.length?u[0]:u:c(this,i)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&c(this,e)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,t.exports=u},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(0),r=function(){function t(){this._defaultMaterial=new n.MeshLambertMaterial({color:13421772})}return t.prototype.get=function(){return this._defaultMaterial},t}();e.default=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(o){Object.defineProperty(t.prototype,o,Object.getOwnPropertyDescriptor(e.prototype,o))}))}))}},function(t,e,o){"use strict";
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){var e=t.call(this)||this;return e.isMesh=!1,e.hasBody=!1,e.name="object-"+e.id,e}return r(e,t),e}(o(0).Group);e.ExtendedGroup=i},function(t,e,o){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(o(13));e.PhysicsLoader=function(t,e){"undefined"!=typeof window&&(window.__loadPhysics=!0),r.default(t,(function(){Ammo().then((function(){e()}))}))}},function(t,e,o){"use strict";
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */Object.defineProperty(e,"__esModule",{value:!0});var n=o(2);e.ExtendedObject3D=n.ExtendedObject3D;var r=o(3);e.ExtendedMesh=r.ExtendedMesh;var i=o(0);e.AnimationMixer=i.AnimationMixer,e.AnimationClip=i.AnimationClip,e.AnimationAction=i.AnimationAction,e.Object3D=i.Object3D,e.Mesh=i.Mesh,e.Material=i.Material,e.Line=i.Line,e.Points=i.Points,e.Group=i.Group},function(t,e,o){"use strict";
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(o(12)),i=o(0),s=function(){function t(t,e){this.physics=t,this.ammo=e,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.breakable=!1,this.didUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new i.Euler,this.tmpQuaternion=new i.Quaternion,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.name=e.name}return t.prototype.destructor=function(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion)},t.prototype.setupEventEmitter=function(){void 0===this.eventEmitter&&(this.eventEmitter=new r.default)},Object.defineProperty(t.prototype,"needUpdate",{get:function(){return this._needUpdate},set:function(t){!t&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=t},enumerable:!0,configurable:!0}),t.prototype.onUpdateEvent=function(t,e){void 0===e&&(e=!1),this.setupEventEmitter(),this._emitUpdateEvents=!0,e?this.eventEmitter.once("update",(function(){t()})):this.eventEmitter.on("update",(function(){t()}))},Object.defineProperty(t.prototype,"on",{get:function(){var t=this;return{update:function(e){return t.onUpdateEvent(e)},collision:function(e){return t.onCollision(e)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"once",{get:function(){var t=this;return{update:function(e){return t.onUpdateEvent(e,!0)}}},enumerable:!0,configurable:!0}),t.prototype.onCollision=function(t){var e=this;this.checkCollisions=!0,this.physics.collisionEvents.on("collision",(function(o){var n=o.bodies,r=o.event;n[0].name===e.name?t(n[1],r):n[1].name===e.name&&t(n[0],r)}))},t.prototype.transform=function(){var t=this.physics.tmpTrans;this.ammo.getMotionState().getWorldTransform(t)},t.prototype.refresh=function(){var t=this.physics.tmpTrans;this.ammo.getMotionState().setWorldTransform(t)},t.prototype.setRotation=function(t,e,o){var n=this.tmpEuler.set(t,e,o),r=this.tmpQuaternion.set(0,0,0,1);r.setFromEuler(n),this.tmpBtQuaternion.setValue(0,0,0,1);var i=this.tmpBtQuaternion;i.setValue(r.x,r.y,r.z,r.w),this.physics.tmpTrans.setRotation(i)},Object.defineProperty(t.prototype,"rotation",{get:function(){var t=this.physics.tmpTrans.getRotation(),e=this.tmpQuaternion.set(t.x(),t.y(),t.z(),t.w()),o=e.x,n=e.y,r=e.z,i=e.w,s=2*Math.acos(i);return{x:o/Math.sqrt(1-i*i)*s||0,y:n/Math.sqrt(1-i*i)*s||0,z:r/Math.sqrt(1-i*i)*s||0}},enumerable:!0,configurable:!0}),t.prototype.setPosition=function(t,e,o){this.physics.tmpTrans.getOrigin().setValue(t,e,o)},Object.defineProperty(t.prototype,"position",{get:function(){var t=this.physics.tmpTrans;return{x:t.getOrigin().x(),y:t.getOrigin().y(),z:t.getOrigin().z()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"velocity",{get:function(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angularVelocity",{get:function(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}},enumerable:!0,configurable:!0}),t.prototype.setVelocity=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setVelocityX=function(t){this.tmpBtVector3.setValue(t,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setVelocityY=function(t){this.tmpBtVector3.setValue(this.velocity.x,t,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setVelocityZ=function(t){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,t),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocity=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocityX=function(t){this.tmpBtVector3.setValue(t,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocityY=function(t){this.tmpBtVector3.setValue(this.angularVelocity.x,t,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocityZ=function(t){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,t),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.applyForce=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyForceX=function(t){this.tmpBtVector3.setValue(t,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyForceY=function(t){this.tmpBtVector3.setValue(0,t,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyForceZ=function(t){this.tmpBtVector3.setValue(0,0,t),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyCentralForce=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyCentralForce(this.tmpBtVector3)},t.prototype.applyCentralImpulse=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyCentralLocalForce=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyCentralLocalForce(this.tmpBtVector3)},t.prototype.applyImpulse=function(t,e){this.tmpBtVector3.setValue(t.x||0,t.y||0,t.z||0),this.tmpBtVector3_1.setValue(e.x||0,e.y||0,e.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)},t.prototype.applyLocalTorque=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyLocalTorque(this.tmpBtVector3)},t.prototype.applyTorque=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyTorque(this.tmpBtVector3)},t.prototype.applyTorqueImpulse=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyTorqueImpulse(this.tmpBtVector3)},t.prototype.setCollisionFlags=function(t){this.ammo.setCollisionFlags(t)},t.prototype.getCollisionFlags=function(){return this.ammo.getCollisionFlags()},t.prototype.setRestitution=function(t){this.ammo.setRestitution(t)},t.prototype.setBounciness=function(t){this.setRestitution(t)},t.prototype.setFriction=function(t){this.ammo.setFriction(t)},t.prototype.setGravity=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setGravity(this.tmpBtVector3)},t.prototype.setLinearFactor=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setLinearFactor(this.tmpBtVector3)},t.prototype.setAngularFactor=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setAngularFactor(this.tmpBtVector3)},t.prototype.setCcdMotionThreshold=function(t){this.ammo.setCcdMotionThreshold(t)},t.prototype.setCcdSweptSphereRadius=function(t){this.ammo.setCcdSweptSphereRadius(t)},t}();e.default=s},function(t,e,o){"use strict";
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__rest||function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(0),a=o(3),c=i(o(1)),u=i(o(5)),l=function(){function t(t){this.scene=t,this.isHeadless="headless"===t,this.defaultMaterial=new u.default}return Object.defineProperty(t.prototype,"make",{get:function(){var t=this;return{plane:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.makePlane(e,o)},box:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.makeBox(e,o)},sphere:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.makeSphere(e,o)},cylinder:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.makeCylinder(e,o)},cone:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.makeCone(e,o)},torus:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.makeTorus(e,o)},extrude:function(e,o){return void 0===o&&(o={}),t.makeExtrude(e,o)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"add",{get:function(){var t=this;return{mesh:function(e){return t.addMesh(e)},existing:function(e){return t.addExisting(e)},plane:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addPlane(e,o)},box:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addBox(e,o)},ground:function(e,o){return void 0===o&&(o={}),t.addGround(e,o)},sphere:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addSphere(e,o)},cylinder:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addCylinder(e,o)},cone:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addCone(e,o)},torus:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addTorus(e,o)},extrude:function(e,o){return void 0===o&&(o={}),t.addExtrude(e,o)},material:function(e){return void 0===e&&(e={}),t.addMaterial(e)}}},enumerable:!0,configurable:!0}),t.prototype.addExisting=function(){for(var t,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];"headless"!==this.scene&&(t=this.scene).add.apply(t,e)},t.prototype.addMesh=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this.addExisting(t[e]);else this.addExisting(t);return this},t.prototype.createMesh=function(t,e,o){var n,r=o.x,i=void 0===r?0:r,c=o.y,u=void 0===c?0:c,l=o.z,m=void 0===l?0:l;switch(!Array.isArray(e)&&e.type){case"LineBasicMaterial":n=new s.Line(t,e);break;case"PointsMaterial":n=new s.Points(t,e);break;default:n=new a.ExtendedMesh(t,e)}return n.position.set(i,u,m),n.castShadow=n.receiveShadow=!0,n},t.prototype.makeExtrude=function(t,e){var o=t.x,i=t.y,a=t.z,c=t.name,u=t.shape,l=t.autoCenter,m=void 0===l||l,d=t.breakable,p=void 0!==d&&d,h=t.bufferGeometry,f=void 0===h||h,y=r(t,["x","y","z","name","shape","autoCenter","breakable","bufferGeometry"]),v=y.depth,b=void 0===v?1:v,g=y.bevelEnabled,w=void 0!==g&&g,x=f||p||this.isHeadless?new s.ExtrudeBufferGeometry(u,n({depth:b,bevelEnabled:w},y)):new s.ExtrudeGeometry(u,n({depth:b,bevelEnabled:w},y)),A=this.addMaterial(e),_=this.createMesh(x,A,{x:o,y:i,z:a});return m&&_.geometry.center(),_.name=c||"body_id_"+_.id,_.shape="extrude",_},t.prototype.addExtrude=function(t,e){void 0===e&&(e={});var o=this.makeExtrude(t,e);return this.addExisting(o),o},t.prototype.makePlane=function(t,e){var o=t.x,n=t.y,i=t.z,a=t.name,c=t.breakable,u=void 0!==c&&c,l=t.bufferGeometry,m=void 0===l||l,d=r(t,["x","y","z","name","breakable","bufferGeometry"]),p=m||u||this.isHeadless?new s.PlaneBufferGeometry(d.width||1,d.height||1,d.widthSegments||1,d.heightSegments||1):new s.PlaneGeometry(d.width||1,d.height||1,d.widthSegments||1,d.heightSegments||1),h=this.addMaterial(e);h.side=s.DoubleSide;var f=this.createMesh(p,h,{x:o,y:n,z:i});return f.name=a||"body_id_"+f.id,f.shape="plane",f},t.prototype.addPlane=function(t,e){var o=this.makePlane(t,e);return this.addExisting(o),o},t.prototype.makeSphere=function(t,e){var o=t.x,n=t.y,i=t.z,a=t.name,c=t.breakable,u=void 0!==c&&c,l=t.bufferGeometry,m=void 0===l||l,d=r(t,["x","y","z","name","breakable","bufferGeometry"]),p=m||u||this.isHeadless?new s.SphereBufferGeometry(d.radius||1,d.widthSegments||16,d.heightSegments||12,d.phiStart||void 0,d.phiLength||void 0,d.thetaStart||void 0,d.thetaLength||void 0):new s.SphereGeometry(d.radius||1,d.widthSegments||16,d.heightSegments||12,d.phiStart||void 0,d.phiLength||void 0,d.thetaStart||void 0,d.thetaLength||void 0),h=this.addMaterial(e),f=this.createMesh(p,h,{x:o,y:n,z:i});return f.name=a||"body_id_"+f.id,f.shape="sphere",f},t.prototype.addSphere=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeSphere(t,e);return this.addExisting(o),o},t.prototype.makeBox=function(t,e){var o=t.x,n=t.y,i=t.z,a=t.name,c=t.breakable,u=void 0!==c&&c,l=t.bufferGeometry,m=void 0===l||l,d=r(t,["x","y","z","name","breakable","bufferGeometry"]),p=m||u||this.isHeadless?new s.BoxBufferGeometry(d.width||1,d.height||1,d.depth||1,d.widthSegments||void 0,d.heightSegments||void 0,d.depthSegments||void 0):new s.BoxGeometry(d.width||1,d.height||1,d.depth||1,d.widthSegments||void 0,d.heightSegments||void 0,d.depthSegments||void 0),h=this.addMaterial(e),f=this.createMesh(p,h,{x:o,y:n,z:i});return f.name=a||"body_id_"+f.id,f.shape="box",f},t.prototype.addBox=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeBox(t,e);return this.addExisting(o),o},t.prototype.addGround=function(t,e){void 0===e&&(e={});var o=this.makeBox(t,e);return o.rotateX(s.MathUtils.degToRad(90)),this.addExisting(o),o},t.prototype.makeCylinder=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=t.x,n=t.y,i=t.z,a=t.name,c=t.breakable,u=void 0!==c&&c,l=t.bufferGeometry,m=void 0===l||l,d=r(t,["x","y","z","name","breakable","bufferGeometry"]),p=m||u||this.isHeadless?new s.CylinderBufferGeometry(d.radiusTop||1,d.radiusBottom||1,d.height||1,d.radiusSegments||void 0,d.heightSegments||void 0,d.openEnded||void 0,d.thetaStart||void 0,d.thetaLength||void 0):new s.CylinderGeometry(d.radiusTop||1,d.radiusBottom||1,d.height||1,d.radiusSegments||void 0,d.heightSegments||void 0,d.openEnded||void 0,d.thetaStart||void 0,d.thetaLength||void 0),h=this.addMaterial(e),f=this.createMesh(p,h,{x:o,y:n,z:i});return f.name=a||"body_id_"+f.id,f.shape="cylinder",f},t.prototype.addCylinder=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeCylinder(t,e);return this.addExisting(o),o},t.prototype.makeCone=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=t.x,n=t.y,i=t.z,a=t.name,c=t.breakable,u=void 0!==c&&c,l=t.bufferGeometry,m=void 0===l||l,d=r(t,["x","y","z","name","breakable","bufferGeometry"]),p=(m||u||this.isHeadless,new s.ConeBufferGeometry(d.radius||1,d.height||1,d.radiusSegments||8,d.heightSegments||1,d.openEnded||!1,d.thetaStart||0,d.thetaLength||2*Math.PI)),h=this.addMaterial(e),f=this.createMesh(p,h,{x:o,y:n,z:i});return f.name=a||"body_id_"+f.id,f.shape="cone",f},t.prototype.addCone=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeCone(t,e);return this.addExisting(o),o},t.prototype.makeTorus=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=t.x,n=t.y,i=t.z,a=t.name,c=t.breakable,u=void 0!==c&&c,l=t.bufferGeometry,m=void 0===l||l,d=r(t,["x","y","z","name","breakable","bufferGeometry"]),p=m||u||this.isHeadless?new s.TorusBufferGeometry(d.radius||void 0,d.tube||void 0,d.radialSegments||void 0,d.tubularSegments||void 0,d.arc||void 0):new s.TorusGeometry(d.radius||void 0,d.tube||void 0,d.radialSegments||void 0,d.tubularSegments||void 0,d.arc||void 0),h=this.addMaterial(e),f=this.createMesh(p,h,{x:o,y:n,z:i});return f.name=a||"body_id_"+f.id,f.shape="torus",f},t.prototype.addTorus=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeTorus(t,e);return this.addExisting(o),o},t.prototype.addMaterial=function(t){void 0===t&&(t={});var e,o=Object.keys(t)[0];if("headless"===this.scene)return this.defaultMaterial.get();switch(o){case"basic":e=new s.MeshBasicMaterial(t.basic);break;case"normal":e=new s.MeshNormalMaterial(t.normal);break;case"standard":e=new s.MeshStandardMaterial(t.standard);break;case"lambert":e=new s.MeshLambertMaterial(t.lambert);break;case"phong":e=new s.MeshPhongMaterial(t.phong);break;case"physical":void 0!==t.physical?e=new s.MeshPhysicalMaterial(t.physical):(c.default("You need to pass parameters to the physical material. (Fallback to default material)"),e=this.defaultMaterial.get());break;case"toon":e=new s.MeshToonMaterial(t.toon);break;case"line":e=new s.LineBasicMaterial(t.line);break;case"points":e=new s.PointsMaterial(t.points);break;case"custom":e=t.custom||this.defaultMaterial.get();break;default:e=this.defaultMaterial.get()}return e},t}();e.default=l},function(t,e,o){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function i(){}function s(t,e,o){this.fn=t,this.context=e,this.once=o||!1}function a(t,e,o,n,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var a=new s(o,n||t,i),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),u.prototype.eventNames=function(){var t,e,o=[];if(0===this._eventsCount)return o;for(e in t=this._events)n.call(t,e)&&o.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},u.prototype.listeners=function(t){var e=r?r+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,i=o.length,s=new Array(i);n<i;n++)s[n]=o[n].fn;return s},u.prototype.listenerCount=function(t){var e=r?r+t:t,o=this._events[e];return o?o.fn?1:o.length:0},u.prototype.emit=function(t,e,o,n,i,s){var a=r?r+t:t;if(!this._events[a])return!1;var c,u,l=this._events[a],m=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),m){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,o),!0;case 4:return l.fn.call(l.context,e,o,n),!0;case 5:return l.fn.call(l.context,e,o,n,i),!0;case 6:return l.fn.call(l.context,e,o,n,i,s),!0}for(u=1,c=new Array(m-1);u<m;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),m){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,o);break;case 4:l[u].fn.call(l[u].context,e,o,n);break;default:if(!c)for(d=1,c=new Array(m-1);d<m;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(t,e,o){return a(this,t,e,o,!1)},u.prototype.once=function(t,e,o){return a(this,t,e,o,!0)},u.prototype.removeListener=function(t,e,o,n){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==e||n&&!s.once||o&&s.context!==o||c(this,i);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==e||n&&!s[a].once||o&&s[a].context!==o)&&u.push(s[a]);u.length?this._events[i]=1===u.length?u[0]:u:c(this,i)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&c(this,e)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,t.exports=u},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1}(),r=function(t,e){var o=document.createElement("script");o.onload=function(){e()},o.onerror=function(){throw new Error("failed to load "+t)},o.async=!0,o.src=t,document.head.appendChild(o)};e.default=function(t,e){r(n?t+"/ammo.wasm.js":t+"/ammo.js",(function(){return e()}))}},function(t,e,o){"use strict";o.r(e),o.d(e,"ExtendedObject3D",(function(){return a.ExtendedObject3D})),o.d(e,"ExtendedMesh",(function(){return u.ExtendedMesh})),o.d(e,"ExtendedGroup",(function(){return l.ExtendedGroup})),o.d(e,"PhysicsLoader",(function(){return st.PhysicsLoader})),o.d(e,"ClosestRaycaster",(function(){return ft})),o.d(e,"AllHitsRaycaster",(function(){return yt})),o.d(e,"Types",(function(){return ut})),o.d(e,"Clock",(function(){return vt})),o.d(e,"AmmoPhysics",(function(){return xt}));var n=o(1),r=o.n(n),i=o(10),s=o.n(i),a=o(2),c=o.n(a),u=o(3),l=o(7),m=function(){return(m=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},d=function(){function t(t,e){this.factory=t,this.addExisting=e}return t.prototype.addPlane=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.add.plane(t,e);return this.addExisting(o,t),o},t.prototype.addSphere=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.add.sphere(t,e);return this.addExisting(o,t),o},t.prototype.addBox=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.add.box(t,e);return this.addExisting(o,t),o},t.prototype.addGround=function(t,e){void 0===e&&(e={});var o=this.factory.add.ground(t,e),n=m(m({},t),{mass:0,collisionFlags:1});return this.addExisting(o,n),o},t.prototype.addCylinder=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.add.cylinder(t,e);return this.addExisting(o,t),o},t.prototype.addCone=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.add.cone(t,e);return this.addExisting(o,t),o},t.prototype.addTorus=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.add.torus(t,e);return this.addExisting(o,t),o},t.prototype.addExtrude=function(t,e){void 0===e&&(e={});var o=this.factory.add.extrude(t,e);return o.translateX(1),this.addExisting(o),o},t}(),p=function(){return(p=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},h=function(){function t(t,e){this.tmpTrans=t,this.physicsWorld=e,this.tmpBtVector3=new Ammo.btVector3}return t.prototype.toAmmoV3=function(t,e){return void 0===e&&(e=0),new Ammo.btVector3(void 0!==(null==t?void 0:t.x)?t.x:e,void 0!==(null==t?void 0:t.y)?t.y:e,void 0!==(null==t?void 0:t.z)?t.z:e)},Object.defineProperty(t.prototype,"addConstraints",{get:function(){var t=this;return{lock:function(e,o){return t.lock(e,o)},fixed:function(e,o){return t.fixed(e,o)},pointToPoint:function(e,o,n){return t.pointToPoint(e,o,n)},hinge:function(e,o,n){return t.hinge(e,o,n)},slider:function(e,o,n){return void 0===n&&(n={}),t.slider(e,o,n)},spring:function(e,o,n){return void 0===n&&(n={}),t.spring(e,o,n)},coneTwist:function(e,o,n,r){return void 0===n&&(n={}),void 0===r&&(r={}),t.coneTwist(e,o,n,r)},dof:function(e,o,n){return t.dof(e,o,n)}}},enumerable:!0,configurable:!0}),t.prototype.getTransform=function(t,e,o,n){void 0===o&&(o={x:0,y:0,z:0}),void 0===n&&(n=!1),o=p({x:0,y:0,z:0},o);var r,i,s,a,c,u=new Ammo.btTransform;if(u.setIdentity(),n){var l,m=(r=t.getWorldTransform().getOrigin(),i=e.getWorldTransform().getOrigin(),s=(r.x()-i.x())/2+o.x,a=(r.y()-i.y())/2+o.y,c=(r.z()-i.z())/2+o.z,new Ammo.btVector3(s,a,c)),d=new Ammo.btTransform;return d.setIdentity(),d.setOrigin(m),(l=t.getCenterOfMassTransform().inverse().op_mul(e.getWorldTransform())).op_mul(d),{transformA:l,transformB:d}}return u.setOrigin(new Ammo.btVector3(o.x,o.y,o.z)),{transformA:l=t.getCenterOfMassTransform().inverse().op_mul(e.getWorldTransform()).op_mul(u),transformB:u}},t.prototype.lock=function(t,e){var o={x:0,y:0,z:0};return this.dof(t,e,{angularLowerLimit:o,angularUpperLimit:o})},t.prototype.fixed=function(t,e){var o=this.getTransform(t.ammo,e.ammo);o.transformA.setRotation(t.ammo.getWorldTransform().getRotation()),o.transformB.setRotation(e.ammo.getWorldTransform().getRotation());var n=new Ammo.btFixedConstraint(t.ammo,e.ammo,o.transformA,o.transformB);return this.physicsWorld.addConstraint(n),n},t.prototype.pointToPoint=function(t,e,o){void 0===o&&(o={});var n=o.pivotA,r=o.pivotB,i=new Ammo.btVector3((null==n?void 0:n.x)||0,(null==n?void 0:n.y)||0,(null==n?void 0:n.z)||0),s=new Ammo.btVector3((null==r?void 0:r.x)||0,(null==r?void 0:r.y)||0,(null==r?void 0:r.z)||0),a=new Ammo.btPoint2PointConstraint(t.ammo,e.ammo,i,s);return this.physicsWorld.addConstraint(a),a},t.prototype.hinge=function(t,e,o){void 0===o&&(o={});var n=o.pivotA,r=o.pivotB,i=o.axisA,s=o.axisB,a=new Ammo.btVector3((null==n?void 0:n.x)||0,(null==n?void 0:n.y)||0,(null==n?void 0:n.z)||0),c=new Ammo.btVector3((null==r?void 0:r.x)||0,(null==r?void 0:r.y)||0,(null==r?void 0:r.z)||0),u=new Ammo.btVector3((null==i?void 0:i.x)||0,(null==i?void 0:i.y)||0,(null==i?void 0:i.z)||0),l=new Ammo.btVector3((null==s?void 0:s.x)||0,(null==s?void 0:s.y)||0,(null==s?void 0:s.z)||0),m=new Ammo.btHingeConstraint(t.ammo,e.ammo,a,c,u,l,!0);return this.physicsWorld.addConstraint(m),m},t.prototype.slider=function(t,e,o){void 0===o&&(o={});var n=this.getTransform(t.ammo,e.ammo),r=o.frameA,i=void 0===r?{}:r,s=o.frameB,a=void 0===s?{}:s,c=o.linearLowerLimit,u=void 0===c?0:c,l=o.linearUpperLimit,m=void 0===l?0:l,d=o.angularLowerLimit,p=void 0===d?0:d,h=o.angularUpperLimit,f=void 0===h?0:h,y=n.transformA.getRotation();y.setEulerZYX(i.x||0,i.y||0,i.z||0),n.transformA.setRotation(y);var v=n.transformB.getRotation();v.setEulerZYX(a.x||0,a.y||0,a.z||0),n.transformB.setRotation(v);var b=new Ammo.btSliderConstraint(t.ammo,e.ammo,n.transformA,n.transformB,!0);return b.setLowerLinLimit(u),b.setUpperLinLimit(m),b.setLowerAngLimit(p),b.setUpperAngLimit(f),this.physicsWorld.addConstraint(b),b},t.prototype.spring=function(t,e,o){void 0===o&&(o={});var n=o.stiffness,r=void 0===n?50:n,i=o.damping,s=void 0===i?.01:i,a=o.angularLock,c=void 0!==a&&a,u=o.linearLowerLimit,l=void 0===u?{}:u,m=o.linearUpperLimit,d=void 0===m?{}:m,p=this.getTransform(t.ammo,e.ammo),h=new Ammo.btGeneric6DofSpringConstraint(t.ammo,e.ammo,p.transformA,p.transformB,!0);this.tmpBtVector3.setValue(l.x||0,l.y||0,l.z||0),h.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(d.x||0,d.y||0,d.z||0),h.setLinearUpperLimit(this.tmpBtVector3),c&&(this.tmpBtVector3.setValue(0,0,0),h.setAngularLowerLimit(this.tmpBtVector3),h.setAngularUpperLimit(this.tmpBtVector3));for(var f=0;f<3;f++)h.enableSpring(f,!0),h.setStiffness(f,r),h.setDamping(f,s);return this.physicsWorld.addConstraint(h),h},t.prototype.coneTwist=function(t,e,o,n){void 0===o&&(o={}),void 0===n&&(n={});var r=new Ammo.btTransform;r.setIdentity(),r.getOrigin().setValue((null==o?void 0:o.x)||0,(null==o?void 0:o.y)||0,(null==o?void 0:o.z)||0);var i=new Ammo.btTransform;i.setIdentity(),i.getOrigin().setValue((null==n?void 0:n.x)||0,(null==n?void 0:n.y)||0,(null==n?void 0:n.z)||0);this.getTransform(t.ammo,e.ammo);var s=new Ammo.btConeTwistConstraint(e.ammo,t.ammo,r,i);return s.setAngularOnly(!0),this.physicsWorld.addConstraint(s),s},t.prototype.dof=function(t,e,o){void 0===o&&(o={});var n=o.offset,r=o.center,i=void 0!==r&&r,s=p({x:0,y:0,z:0},n),a=this.getTransform(t.ammo,e.ammo,s,i),c=new Ammo.btGeneric6DofConstraint(t.ammo,e.ammo,a.transformA,a.transformB,!0),u=o.linearLowerLimit,l=o.linearUpperLimit,m=o.angularLowerLimit,d=o.angularUpperLimit,h=this.toAmmoV3(u),f=this.toAmmoV3(l),y=this.toAmmoV3(m,-Math.PI),v=this.toAmmoV3(d,Math.PI);return c.setLinearLowerLimit(h),c.setLinearUpperLimit(f),c.setAngularLowerLimit(y),c.setAngularUpperLimit(v),Ammo.destroy(h),Ammo.destroy(f),Ammo.destroy(y),Ammo.destroy(v),this.physicsWorld.addConstraint(c,!1),c},t}(),f=o(4),y=o.n(f),v=o(0);
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */
const b="box",g="cylinder",w="sphere",x="capsule",A="cone",_="hull",V="hacd",P="vhacd",C="mesh",O="heightfield",M="all",B="manual",E=c.a.prototype.hasOwnProperty("updateMatrices"),T=function(t,e){switch(e.type){case b:return j(t,e);case g:return S(t,e);case x:return k(t,e);case A:return z(t,e);case w:return D(t,e);case _:return L(t,e);case V:return R(t,e);case P:return H(t,e);case C:return W(t,e);case O:return F(t,e);default:return r()(e.type+" is not currently supported"),[]}},j=function(t,e){e.type=b,I(e),e.fit===M&&(e.halfExtents=q(t,Y(t,e),e.minHalfExtent,e.maxHalfExtent));const o=new Ammo.btVector3(e.halfExtents.x,e.halfExtents.y,e.halfExtents.z),n=new Ammo.btBoxShape(o);return Ammo.destroy(o),G(n,e,U(t,e)),n},S=function(t,e){e.type=g,I(e),e.fit===M&&(e.halfExtents=q(t,Y(t,e),e.minHalfExtent,e.maxHalfExtent));const o=new Ammo.btVector3(e.halfExtents.x,e.halfExtents.y,e.halfExtents.z),n=(()=>{switch(e.cylinderAxis){case"y":return new Ammo.btCylinderShape(o);case"x":return new Ammo.btCylinderShapeX(o);case"z":return new Ammo.btCylinderShapeZ(o)}return null})();return Ammo.destroy(o),G(n,e,U(t,e)),n},k=function(t,e){e.type=x,I(e),e.fit===M&&(e.halfExtents=q(t,Y(t,e),e.minHalfExtent,e.maxHalfExtent));const{x:o,y:n,z:r}=e.halfExtents,i=(()=>{switch(e.cylinderAxis){case"y":return new Ammo.btCapsuleShape(Math.max(o,r),2*n);case"x":return new Ammo.btCapsuleShapeX(Math.max(n,r),2*o);case"z":return new Ammo.btCapsuleShapeZ(Math.max(o,n),2*r)}return null})();return G(i,e,U(t,e)),i},z=function(t,e){e.type=A,I(e),e.fit===M&&(e.halfExtents=q(t,Y(t,e),e.minHalfExtent,e.maxHalfExtent));const{x:o,y:n,z:r}=e.halfExtents,i=(()=>{switch(e.cylinderAxis){case"y":return new Ammo.btConeShape(Math.max(o,r),2*n);case"x":return new Ammo.btConeShapeX(Math.max(n,r),2*o);case"z":return new Ammo.btConeShapeZ(Math.max(o,n),2*r)}return null})();return G(i,e,U(t,e)),i},D=function(t,e){let o;e.type=w,I(e),o=e.fit!==B||isNaN(e.sphereRadius)?Q(t,e,Y(t,e)):e.sphereRadius;const n=new Ammo.btSphereShape(o);return G(n,e,U(t,e)),n},L=function(){const t=new v.Vector3,e=new v.Vector3;return function(o,n){if(n.type=_,I(n),n.fit===B)return console.warn("cannot use fit: manual with type: hull"),null;const r=Y(o,n),i=new Ammo.btVector3,s=new Ammo.btConvexHullShape;s.setMargin(n.margin),e.addVectors(r.max,r.min).multiplyScalar(.5);let a=0;N(o,n,t=>{a+=t.attributes.position.array.length/3});const c=n.hullMaxVertices||1e5;a>c&&console.warn(`too many vertices for hull shape; sampling ~${c} from ~${a} vertices`);const u=Math.min(1,c/a);N(o,n,(o,n)=>{X(o,n);const r=o.attributes.position.array;for(let o=0;o<r.length;o+=3)Math.random()<=u&&(t.set(r[o],r[o+1],r[o+2]).applyMatrix4(n).sub(e),i.setValue(t.x,t.y,t.z),s.addPoint(i,o===r.length-3))});let l=s;if(s.getNumVertices()>=100){const t=new Ammo.btShapeHull(s);t.buildHull(n.margin),Ammo.destroy(s),l=new Ammo.btConvexHullShape(Ammo.getPointer(t.getVertexPointer()),t.numVertices()),Ammo.destroy(t)}return Ammo.destroy(i),G(l,n,U(o,n)),l}}(),R=function(){const t=new v.Vector3,e=new v.Vector3;return function(o,n){if(n.type=V,I(n),n.fit===B)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const r=Y(o),i=U(o,n);let s=0,a=0;e.addVectors(r.max,r.min).multiplyScalar(.5),N(o,n,t=>{s+=t.attributes.position.array.length/3,t.index?a+=t.index.array.length/3:a+=t.attributes.position.array.length/9});const c=new Ammo.HACD;n.hasOwnProperty("compacityWeight")&&c.SetCompacityWeight(n.compacityWeight),n.hasOwnProperty("volumeWeight")&&c.SetVolumeWeight(n.volumeWeight),n.hasOwnProperty("nClusters")&&c.SetNClusters(n.nClusters),n.hasOwnProperty("nVerticesPerCH")&&c.SetNVerticesPerCH(n.nVerticesPerCH),n.hasOwnProperty("concavity")&&c.SetConcavity(n.concavity);const u=Ammo._malloc(3*s*8),l=Ammo._malloc(3*a*4);c.SetPoints(u),c.SetTriangles(l),c.SetNPoints(s),c.SetNTriangles(a);const m=u/8,d=l/4;N(o,n,(o,n)=>{X(o,n);const r=o.attributes.position.array,i=o.index?o.index.array:null;for(let o=0;o<r.length;o+=3)t.set(r[o+0],r[o+1],r[o+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[m+o+0]=t.x,Ammo.HEAPF64[m+o+1]=t.y,Ammo.HEAPF64[m+o+2]=t.z;if(i)for(let t=0;t<i.length;t++)Ammo.HEAP32[d+t]=i[t];else for(let t=0;t<r.length/3;t++)Ammo.HEAP32[d+t]=t}),c.Compute(),Ammo._free(u),Ammo._free(l);const p=c.GetNClusters(),h=[];for(let t=0;t<p;t++){const e=new Ammo.btConvexHullShape;e.setMargin(n.margin);const o=c.GetNPointsCH(t),r=c.GetNTrianglesCH(t),s=Ammo._malloc(3*o*8),a=Ammo._malloc(3*r*4);c.GetCH(t,s,a);const u=s/8;for(let t=0;t<o;t++){const n=new Ammo.btVector3,r=Ammo.HEAPF64[u+3*t+0],i=Ammo.HEAPF64[u+3*t+1],s=Ammo.HEAPF64[u+3*t+2];n.setValue(r,i,s),e.addPoint(n,t===o-1),Ammo.destroy(n)}G(e,n,i),h.push(e)}return h}}(),H=function(){const t=new v.Vector3,e=new v.Vector3;return function(o,n){if(n.type=P,I(n),n.fit===B)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const r=Y(o,n),i=U(o,n);let s=0,a=0;e.addVectors(r.max,r.min).multiplyScalar(.5),N(o,n,t=>{s+=t.attributes.position.count,t.index?a+=t.index.count/3:a+=t.attributes.position.count/3});const c=new Ammo.VHACD,u=new Ammo.Parameters;n.hasOwnProperty("resolution")&&u.set_m_resolution(n.resolution),n.hasOwnProperty("depth")&&u.set_m_depth(n.depth),n.hasOwnProperty("concavity")&&u.set_m_concavity(n.concavity),n.hasOwnProperty("planeDownsampling")&&u.set_m_planeDownsampling(n.planeDownsampling),n.hasOwnProperty("convexhullDownsampling")&&u.set_m_convexhullDownsampling(n.convexhullDownsampling),n.hasOwnProperty("alpha")&&u.set_m_alpha(n.alpha),n.hasOwnProperty("beta")&&u.set_m_beta(n.beta),n.hasOwnProperty("gamma")&&u.set_m_gamma(n.gamma),n.hasOwnProperty("pca")&&u.set_m_pca(n.pca),n.hasOwnProperty("mode")&&u.set_m_mode(n.mode),n.hasOwnProperty("maxNumVerticesPerCH")&&u.set_m_maxNumVerticesPerCH(n.maxNumVerticesPerCH),n.hasOwnProperty("minVolumePerCH")&&u.set_m_minVolumePerCH(n.minVolumePerCH),n.hasOwnProperty("convexhullApproximation")&&u.set_m_convexhullApproximation(n.convexhullApproximation),n.hasOwnProperty("oclAcceleration")&&u.set_m_oclAcceleration(n.oclAcceleration);const l=Ammo._malloc(3*s*8),m=Ammo._malloc(3*a*4);let d=l/8,p=m/4;N(o,n,(o,n)=>{X(o,n);const r=o.attributes.position.array,i=o.index?o.index.array:null;for(let o=0;o<r.length;o+=3)t.set(r[o+0],r[o+1],r[o+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[d+0]=t.x,Ammo.HEAPF64[d+1]=t.y,Ammo.HEAPF64[d+2]=t.z,d+=3;if(i)for(let t=0;t<i.length;t++)Ammo.HEAP32[p]=i[t],p++;else for(let t=0;t<r.length/3;t++)Ammo.HEAP32[p]=t,p++}),c.Compute(l,3,s,m,3,a,u),Ammo._free(l),Ammo._free(m);const h=c.GetNConvexHulls(),f=[],y=new Ammo.ConvexHull;for(let t=0;t<h;t++){c.GetConvexHull(t,y);const e=y.get_m_nPoints(),o=(y.get_m_points(),new Ammo.btConvexHullShape);o.setMargin(n.margin);for(let t=0;t<e;t++){const n=new Ammo.btVector3,r=y.get_m_points(3*t+0),i=y.get_m_points(3*t+1),s=y.get_m_points(3*t+2);n.setValue(r,i,s),o.addPoint(n,t===e-1),Ammo.destroy(n)}G(o,n,i),f.push(o)}return Ammo.destroy(y),Ammo.destroy(c),f}}(),W=function(){const t=new v.Vector3,e=new v.Vector3,o=new v.Vector3;return function(n,r){if(r.type=C,I(r),r.fit===B)return console.warn("cannot use fit: manual with type: mesh"),null;const i=U(n,r),s=new Ammo.btVector3,a=new Ammo.btVector3,c=new Ammo.btVector3,u=new Ammo.btTriangleMesh(!0,!1);let l;return N(n,r,(n,r)=>{const i=n.attributes.position.array;if(n.index)for(let l=0;l<n.index.count;l+=3){const m=3*n.index.array[l],d=3*n.index.array[l+1],p=3*n.index.array[l+2];t.set(i[m],i[m+1],i[m+2]).applyMatrix4(r),e.set(i[d],i[d+1],i[d+2]).applyMatrix4(r),o.set(i[p],i[p+1],i[p+2]).applyMatrix4(r),s.setValue(t.x,t.y,t.z),a.setValue(e.x,e.y,e.z),c.setValue(o.x,o.y,o.z),u.addTriangle(s,a,c,!1)}else for(let n=0;n<i.length;n+=9)t.set(i[n+0],i[n+1],i[n+2]).applyMatrix4(r),e.set(i[n+3],i[n+4],i[n+5]).applyMatrix4(r),o.set(i[n+6],i[n+7],i[n+8]).applyMatrix4(r),s.setValue(t.x,t.y,t.z),a.setValue(e.x,e.y,e.z),c.setValue(o.x,o.y,o.z),u.addTriangle(s,a,c,!1)}),l=r.concave?new Ammo.btBvhTriangleMeshShape(u,!0,!0):new Ammo.btConvexTriangleMeshShape(u,!0),l.resources=[u],Ammo.destroy(s),Ammo.destroy(a),Ammo.destroy(c),G(l,r,i),l}}(),F=function(t,e){if(I(e),e.fit===M)return console.warn("cannot use fit: all with type: heightfield"),null;const o=e.heightfieldDistance||1,n=e.heightfieldData||[],r=e.heightScale||0,i=e.hasOwnProperty("upAxis")?e.upAxis:1,s=(()=>{switch(e.heightDataType){case"short":return Ammo.PHY_SHORT;case"float":default:return Ammo.PHY_FLOAT}})(),a=!e.hasOwnProperty("flipQuadEdges")||e.flipQuadEdges,c=n.length,u=c>0?n[0].length:0,l=Ammo._malloc(c*u*4),m=l/4;let d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,h=0;for(let t=0;t<c;t++)for(let e=0;e<u;e++){const o=n[t][e];Ammo.HEAPF32[m+h]=o,h++,d=Math.min(d,o),p=Math.max(p,o)}const f=new Ammo.btHeightfieldTerrainShape(u,c,l,r,d,p,i,s,a),y=new Ammo.btVector3(o,1,o);return f.setLocalScaling(y),Ammo.destroy(y),f.heightfieldData=l,G(f,e),f};function I(t){t.fit=t.hasOwnProperty("fit")?t.fit:M,t.type=t.type||_,t.minHalfExtent=t.hasOwnProperty("minHalfExtent")?t.minHalfExtent:0,t.maxHalfExtent=t.hasOwnProperty("maxHalfExtent")?t.maxHalfExtent:Number.POSITIVE_INFINITY,t.cylinderAxis=t.cylinderAxis||"y",t.margin=t.hasOwnProperty("margin")?t.margin:.05,t.includeInvisible=!!t.hasOwnProperty("includeInvisible")&&t.includeInvisible,t.offset||(t.offset=new v.Vector3),t.orientation||(t.orientation=new v.Quaternion)}const G=function(t,e,o){if(t.type=e.type,t.setMargin(e.margin),t.destroy=()=>{for(let e of t.resources||[])Ammo.destroy(e);t.heightfieldData&&Ammo._free(t.heightfieldData),Ammo.destroy(t)},o){const e=new Ammo.btVector3(o.x,o.y,o.z);t.setLocalScaling(e),Ammo.destroy(e)}},N=function(){const t=new v.Matrix4,e=new v.Matrix4,o=new v.BufferGeometry;return function(n,r,i){e.getInverse(n.matrixWorld),n.traverse(r=>{r.isMesh&&(r===n?t.identity():(E&&r.updateMatrices(),t.multiplyMatrices(e,r.matrixWorld)),i(r.geometry.isBufferGeometry?r.geometry:o.fromGeometry(r.geometry),t))})}}(),U=function(t,e){const{scale:o}=t;return o},Q=function(){const t=new v.Vector3,e=new v.Vector3;return function(o,n,r){let i=0,{x:s,y:a,z:c}=r.getCenter(e);return N(o,n,(e,o)=>{const n=e.attributes.position.array;for(let e=0;e<n.length;e+=3){t.set(n[e],n[e+1],n[e+2]).applyMatrix4(o);const r=s-t.x,u=a-t.y,l=c-t.z;i=Math.max(i,r*r+u*u+l*l)}}),Math.sqrt(i)}}(),q=function(t,e,o,n){return(new v.Vector3).subVectors(e.max,e.min).multiplyScalar(.5).clampScalar(o,n)},Y=function(){const t=new v.Vector3;return function(e,o){const n=new v.Box3;let r=1/0,i=1/0,s=1/0,a=-1/0,c=-1/0,u=-1/0;return n.min.set(0,0,0),n.max.set(0,0,0),N(e,o,(e,o)=>{const n=e.attributes.position.array;for(let e=0;e<n.length;e+=3)t.set(n[e],n[e+1],n[e+2]).applyMatrix4(o),t.x<r&&(r=t.x),t.y<i&&(i=t.y),t.z<s&&(s=t.z),t.x>a&&(a=t.x),t.y>c&&(c=t.y),t.z>u&&(u=t.z)}),n.min.set(r,i,s),n.max.set(a,c,u),n}}(),X=(t,e)=>{t.computeBoundingBox();const o=new v.Vector3;t.boundingBox.getCenter(o),e.makeTranslation(o.x,o.y,o.z)};
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
var Z,$,K=o(11),J=o.n(K),tt=(Z=function(t,e){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}Z(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tt(e,t),e.prototype.addCollider=function(t,e,o){t.body&&e.body&&(t.body.checkCollisions=!0,e.body.checkCollisions=!0,this.on("collision",(function(n){var r,i,s=n.bodies,a=n.event;(null===(r=s[0])||void 0===r?void 0:r.name)&&(null===(i=s[1])||void 0===i?void 0:i.name)&&(null==t?void 0:t.name)&&(null==e?void 0:e.name)&&(s[0].name===t.name&&s[1].name===e.name||s[1].name===t.name&&s[0].name===e.name)&&o(a)})))},e}(y.a),ot=1,nt=32768,rt=function(){function t(t,e,o){void 0===o&&(o={}),this.scene=t,this.world=e,this.options=o,this.debugDrawMode=o.debugDrawMode||ot;var n=this.debugDrawMode&nt||!1,r=o.maxBufferSize||1e6;this.geometry=new v.BufferGeometry;var i=new Float32Array(3*r),s=new Float32Array(3*r);this.geometry.setAttribute("position",new v.BufferAttribute(i,3).setUsage(v.StaticDrawUsage)),this.geometry.setAttribute("color",new v.BufferAttribute(s,3).setUsage(v.StaticDrawUsage)),this.index=0;var a=new v.LineBasicMaterial({vertexColors:!0,depthTest:!n});this.mesh=new v.LineSegments(this.geometry,a),n&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}return t.prototype.enable=function(){this.enabled=!0,this.scene.add(this.mesh)},t.prototype.disable=function(){this.enabled=!1,this.scene.remove(this.mesh)},t.prototype.update=function(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))},t.prototype.drawLine=function(t,e,o){var n=Ammo.HEAPF32,r=n[(o+0)/4],i=n[(o+4)/4],s=n[(o+8)/4],a=n[(t+0)/4],c=n[(t+4)/4],u=n[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,a,c,u),this.geometry.attributes.color.setXYZ(this.index++,r,i,s);var l=n[(e+0)/4],m=n[(e+4)/4],d=n[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,l,m,d),this.geometry.attributes.color.setXYZ(this.index++,r,i,s)},t.prototype.drawContactPoint=function(t,e,o,n,r){var i=Ammo.HEAPF32,s=i[(r+0)/4],a=i[(r+4)/4],c=i[(r+8)/4],u=i[(t+0)/4],l=i[(t+4)/4],m=i[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,u,l,m),this.geometry.attributes.color.setXYZ(this.index++,s,a,c);var d=i[(e+0)/4]*o,p=i[(e+4)/4]*o,h=i[(e+8)/4]*o;this.geometry.attributes.position.setXYZ(this.index,u+d,l+p,m+h),this.geometry.attributes.color.setXYZ(this.index++,s,a,c)},t.prototype.reportErrorWarning=function(t){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(t)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))},t.prototype.draw3dText=function(t,e){console.warn("TODO: draw3dText")},t.prototype.setDebugMode=function(t){this.debugDrawMode=t},t.prototype.getDebugMode=function(){return this.debugDrawMode},t}(),it=function(t,e){this.minSizeForBreak=t||1.4,this.smallDelta=e||1e-4,this.tempLine1=new v.Line3,this.tempPlane1=new v.Plane,this.tempPlane2=new v.Plane,this.tempPlane_Cut=new v.Plane,this.tempCM1=new v.Vector3,this.tempCM2=new v.Vector3,this.tempVector3=new v.Vector3,this.tempVector3_2=new v.Vector3,this.tempVector3_3=new v.Vector3,this.tempVector3_P0=new v.Vector3,this.tempVector3_P1=new v.Vector3,this.tempVector3_P2=new v.Vector3,this.tempVector3_N0=new v.Vector3,this.tempVector3_N1=new v.Vector3,this.tempVector3_AB=new v.Vector3,this.tempVector3_CB=new v.Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var o=0;o<900;o++)this.segments[o]=!1};it.prototype={constructor:it,prepareBreakableObject:function(t,e,o,n,r){t.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var i=t.userData;i.mass=e,i.velocity=o.clone(),i.angularVelocity=n.clone(),i.breakable=r},subdivideByImpact:function(t,e,o,n,r){var i=[],s=this.tempPlane1,a=this.tempPlane2;this.tempVector3.addVectors(e,o),s.setFromCoplanarPoints(e,t.position,this.tempVector3);var c=r+n,u=this;return function r(l,m,d,p){if(Math.random()<.05*p||p>c)i.push(l);else{var h=Math.PI;0===p?(a.normal.copy(s.normal),a.constant=s.constant):p<=n?(h=(d-m)*(.2+.6*Math.random())+m,u.tempVector3_2.copy(t.position).sub(e).applyAxisAngle(o,h).add(e),a.setFromCoplanarPoints(e,u.tempVector3,u.tempVector3_2)):(h=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(e).sub(l.position).applyAxisAngle(o,h).add(l.position),u.tempVector3_3.copy(o).add(l.position),a.setFromCoplanarPoints(l.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(l,a,u.tempResultObjects);var f=u.tempResultObjects.object1,y=u.tempResultObjects.object2;f&&r(f,m,h,p+1),y&&r(y,h,d,p+1)}}(t,0,2*Math.PI,0),i},cutByPlane:function(t,e,o){var n=t.geometry,i=n.attributes.position.array,s=n.attributes.normal.array,a=i.length/3,c=a/3,u=n.getIndex();function l(t,e){var o=3*t+e;return u?u[o]:o}u&&(c=(u=u.array).length/3);for(var m=[],d=[],p=this.smallDelta,h=a*a,f=0;f<h;f++)this.segments[f]=!1;var y=this.tempVector3_P0,b=this.tempVector3_P1,g=this.tempVector3_N0,w=this.tempVector3_N1;for(f=0;f<c-1;f++){var x=l(f,0),A=l(f,1),_=l(f,2);g.set(s[x],s[x]+1,s[x]+2);for(var V=f+1;V<c;V++){var P=l(V,0),C=l(V,1),O=l(V,2);w.set(s[P],s[P]+1,s[P]+2),1-g.dot(w)<p&&(x===P||x===C||x===O?A===P||A===C||A===O?(this.segments[x*a+A]=!0,this.segments[A*a+x]=!0):(this.segments[_*a+x]=!0,this.segments[x*a+_]=!0):A!==P&&A!==C&&A!==O||(this.segments[_*a+A]=!0,this.segments[A*a+_]=!0))}}var M=this.tempPlane_Cut;t.updateMatrix(),it.transformPlaneToLocalSpace(e,t.matrix,M);for(f=0;f<c;f++)for(var B=l(f,0),E=l(f,1),T=l(f,2),j=0;j<3;j++){var S=0===j?B:1===j?E:T,k=0===j?E:1===j?T:B;if(!this.segments[S*a+k]){this.segments[S*a+k]=!0,this.segments[k*a+S]=!0,y.set(i[3*S],i[3*S+1],i[3*S+2]),b.set(i[3*k],i[3*k+1],i[3*k+2]);var z=0;(D=M.distanceToPoint(y))>p?(z=2,d.push(y.clone())):D<-p?(z=1,m.push(y.clone())):(z=3,m.push(y.clone()),d.push(y.clone()));var D,L=0;if((D=M.distanceToPoint(b))>p?(L=2,d.push(b.clone())):D<-p?(L=1,m.push(b.clone())):(L=3,m.push(b.clone()),d.push(b.clone())),1===z&&2===L||2===z&&1===L){this.tempLine1.start.copy(y),this.tempLine1.end.copy(b);var R=new v.Vector3;if(void 0===(R=M.intersectLine(this.tempLine1,R)))return console.error("Internal error: segment does not intersect plane."),o.segmentedObject1=null,o.segmentedObject2=null,0;m.push(R),d.push(R.clone())}}}var H=.5*t.userData.mass;this.tempCM1.set(0,0,0);var W=0,F=m.length;if(F>0){for(f=0;f<F;f++)this.tempCM1.add(m[f]);this.tempCM1.divideScalar(F);for(f=0;f<F;f++){(N=m[f]).sub(this.tempCM1),W=Math.max(W,N.x,N.y,N.z)}this.tempCM1.add(t.position)}this.tempCM2.set(0,0,0);var I=0,G=d.length;if(G>0){for(f=0;f<G;f++)this.tempCM2.add(d[f]);this.tempCM2.divideScalar(G);for(f=0;f<G;f++){var N;(N=d[f]).sub(this.tempCM2),I=Math.max(I,N.x,N.y,N.z)}this.tempCM2.add(t.position)}var U=null,Q=null,q=0;if(F>4)try{(U=new v.Mesh(new v.ConvexBufferGeometry(m),t.material)).position.copy(this.tempCM1),U.quaternion.copy(t.quaternion),this.prepareBreakableObject(U,H,t.userData.velocity,t.userData.angularVelocity,2*W>this.minSizeForBreak),q++}catch(t){r()("Error in ConvexObjectBreaker.ts")}if(G>4)try{(Q=new v.Mesh(new v.ConvexBufferGeometry(d),t.material)).position.copy(this.tempCM2),Q.quaternion.copy(t.quaternion),this.prepareBreakableObject(Q,H,t.userData.velocity,t.userData.angularVelocity,2*I>this.minSizeForBreak),q++}catch(t){r()("Error in ConvexObjectBreaker.ts")}return o.object1=U,o.object2=Q,q}},it.transformFreeVector=function(t,e){var o=t.x,n=t.y,r=t.z,i=e.elements;return t.x=i[0]*o+i[4]*n+i[8]*r,t.y=i[1]*o+i[5]*n+i[9]*r,t.z=i[2]*o+i[6]*n+i[10]*r,t},it.transformFreeVectorInverse=function(t,e){var o=t.x,n=t.y,r=t.z,i=e.elements;return t.x=i[0]*o+i[1]*n+i[2]*r,t.y=i[4]*o+i[5]*n+i[6]*r,t.z=i[8]*o+i[9]*n+i[10]*r,t},it.transformTiedVectorInverse=function(t,e){var o=t.x,n=t.y,r=t.z,i=e.elements;return t.x=i[0]*o+i[1]*n+i[2]*r-i[12],t.y=i[4]*o+i[5]*n+i[6]*r-i[13],t.z=i[8]*o+i[9]*n+i[10]*r-i[14],t},it.transformPlaneToLocalSpace=($=new v.Vector3,function(t,e,o){o.normal.copy(t.normal),o.constant=t.constant;var n=it.transformTiedVectorInverse(t.coplanarPoint($),e);it.transformFreeVectorInverse(o.normal,e),o.constant=-n.dot(o.normal)});var st=o(8),at=o(5),ct=o.n(at),ut=o(9),lt=o(6),mt=o.n(lt),dt=function(){function t(t){this.physics=t}return t.prototype.getHitPointWorld=function(){var t=this._btRayCallback.get_m_hitPointWorld();return{x:t.x(),y:t.y(),z:t.z()}},t.prototype.getHitNormalWorld=function(){var t=this._btRayCallback.get_m_hitNormalWorld();return{x:t.x(),y:t.y(),z:t.z()}},t.prototype.getCollisionObject=function(){var t,e=(t=this._btRayCallback.get_m_collisionObject(),Object.values(t)[0]);return this.physics.objectsAmmo[e]},t}(),pt=function(){function t(t){this.physics=t}return t.prototype.getHitPointsWorld=function(){for(var t=this._btRayCallback.get_m_hitPointWorld(),e=[],o=t.size()-1;o>=0;o--){var n=t.at(o);e.push({x:n.x(),y:n.y(),z:n.z()})}return e},t.prototype.getHitPointWorld=function(){return console.warn("[enable3d] Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()},t.prototype.getHitNormalsWorld=function(){for(var t=this._btRayCallback.get_m_hitNormalWorld(),e=[],o=t.size()-1;o>=0;o--){var n=t.at(o);e.push({x:n.x(),y:n.y(),z:n.z()})}return e},t.prototype.getCollisionObjects=function(){for(var t,e=[],o=this._btRayCallback.get_m_collisionObjects(),n=o.size()-1;n>=0;n--){var r=(t=o.at(n),Object.values(t)[0]);e.push(this.physics.objectsAmmo[r])}return e},t}(),ht=function(){function t(t){this.physics=t}return t.prototype.setRayFromWorld=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),this._btRayFrom.setValue(t,e,o)},t.prototype.setRayToWorld=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),this._btRayTo.setValue(t,e,o)},t.prototype.hasHit=function(){return this._btRayCallback.hasHit()},t.prototype.rayTest=function(){void 0!==this._btRayCallback&&Ammo.destroy(this._btRayCallback),this._btRayCallback="closest"===this.type?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)},t.prototype.destroy=function(){void 0!==this._btRayFrom&&Ammo.destroy(this._btRayFrom),void 0!==this._btRayTo&&Ammo.destroy(this._btRayTo),void 0!==this._btRayCallback&&Ammo.destroy(this._btRayCallback)},t}(),ft=function(t){this.physics=t,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)},yt=function(t){this.physics=t,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)};mt()(ft,[ht,dt]),mt()(yt,[ht,pt]);var vt=function(){function t(t){void 0===t&&(t=!0),this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return t.prototype.start=function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},t.prototype.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},t.prototype.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},t.prototype.getDelta=function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t},t}(),bt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),gt=function(){return(gt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},wt=function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<o;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,r++)n[r]=i[s];return n},xt=function(t){function e(e,o){void 0===o&&(o={});var n=t.call(this)||this;if(n.scene=e,n.config=o,n.rigidBodies=[],n.objectsAmmo={},n.earlierDetectedCollisions=[],n.gravity=o.gravity||{x:0,y:-9.81,z:0},n.isHeadless="headless"===e,n.tmpEuler=new v.Euler,n.tmpQuaternion=new v.Quaternion,n.tmpVector3=new v.Vector3,n.tmpBtVector3=new Ammo.btVector3,n.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),n.emptyV3=new v.Vector3,n.impactPoint=new v.Vector3,n.impactNormal=new v.Vector3,"headless"!==e){n.defaultMaterial=new ct.a;var r="three.js version "+v.REVISION;console.log("%c %c %c %c %c "+r+" %c https://threejs.org/","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}return n.start(),n}return bt(e,t),e.prototype.destroy=function(t){var e,o=Object.keys(t).includes("body")?t.body:t;if(void 0!==(null==o?void 0:o.ammo)){var n=Object.values(o.ammo)[0],r=Object.values(o.ammo)[1],i=this.objectsAmmo[n];if(n&&r&&i&&(null===(e=null==i?void 0:i.body)||void 0===e?void 0:e.ammo)){this.physicsWorld.removeRigidBody(i.body.ammo),i.body.destructor(),i.body=void 0,i.hasBody=!1,delete this.objectsAmmo[n];for(var s=0;s<this.rigidBodies.length;s++)this.rigidBodies[s].name===r&&(this.rigidBodies.splice(s,1),s--)}"headless"===this.scene&&i&&(i=null)}},e.prototype.setup=function(){var t=this;if(this.setupPhysicsWorld(),"headless"!==this.scene){this.convexBreaker=new it,this.objectsToRemove=[],this.numObjectsToRemove=0;for(var e=0;e<500;e++)this.objectsToRemove[e]=null}this.collisionEvents=new et,this.factory=new J.a(this.scene),this.shapes=new d(this.factory,(function(e,o){return t.addExisting(e,o)})),this.constraints=new h(this.tmpTrans,this.physicsWorld),"headless"!==this.scene&&(this.debugDrawer=new rt(this.scene,this.physicsWorld,{}))},e.prototype.updateDebugger=function(){"headless"!==this.scene&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()},e.prototype.setupPhysicsWorld=function(){var t=this.gravity,e=new Ammo.btDefaultCollisionConfiguration,o=new Ammo.btCollisionDispatcher(e),n=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver;this.physicsWorld=new Ammo.btDiscreteDynamicsWorld(o,n,r,e),this.physicsWorld.setGravity(new Ammo.btVector3(t.x,t.y,t.z)),this.dispatcher=o,this.tmpTrans=new Ammo.btTransform},e.prototype.createDebrisFromBreakableObject=function(t,e){"headless"!==this.scene&&(t.material=this.defaultMaterial.get(),t.shape="hull",t.fragmentDepth=e.fragmentDepth+1,this.scene.add(t),this.addExisting(t),t.body.breakable=!1,setTimeout((function(){t.body.breakable=!0}),2500))},e.prototype.removeDebris=function(t){"headless"!==this.scene&&(this.scene.remove(t),this.physicsWorld.removeRigidBody(t.body.ammo),delete this.objectsAmmo[t.ptr])},e.prototype.update=function(t){var e,o,n=this;this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);var r=[],i=t/1e3;this.physicsWorld.stepSimulation(i,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(var s=0,a=this.rigidBodies.length;s<a;s++){var c=this.rigidBodies[s],u=c.body.ammo.getMotionState();if(u)if(u.getWorldTransform(this.tmpTrans),c.body.didUpdate&&(c.body._emitUpdateEvents&&c.body.eventEmitter.emit("update"),c.body.didUpdate=!1),c.body.ammo.isKinematicObject()&&c.body.needUpdate)c.getWorldQuaternion(this.tmpQuaternion),c.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.tmpTrans.setOrigin(this.tmpBtVector3),this.tmpTrans.setRotation(this.tmpBtQuaternion),u.setWorldTransform(this.tmpTrans),c.body.needUpdate=!1;else{var l=this.tmpTrans.getOrigin(),m=this.tmpTrans.getRotation(),d=c.body.offset;c.position.set(l.x()+d.x,l.y()+d.y,l.z()+d.z),c.quaternion.set(m.x(),m.y(),m.z(),m.w())}}for(s=0,a=this.dispatcher.getNumManifolds();s<a;s++){var p=this.dispatcher.getManifoldByIndexInternal(s),h=Object.keys(p.getBody0())[0],f=Ammo.castObject(p.getBody0(),Ammo.btRigidBody),y=Ammo.castObject(p.getBody1(),Ammo.btRigidBody);if(""!==f.name||""!==y.name){var v=f[h],b=y[h],g=this.objectsAmmo[v],w=this.objectsAmmo[b];if(g&&w){var x=g.body.breakable,A=w.body.breakable,_=null===(e=g.body)||void 0===e?void 0:e.checkCollisions,V=null===(o=w.body)||void 0===o?void 0:o.checkCollisions;if(_||V||x||A){for(var P=!1,C=0,O="start",M=function(t,e){var o=p.getContactPoint(t);if(o.getDistance()<=0){P=!0;var n=o.getAppliedImpulse(),i=o.get_m_positionWorldOnB(),s=o.get_m_normalWorldOnB();if(_||V){var a=[g.name,w.name].sort(),c=a[0]+"__"+a[1];B.earlierDetectedCollisions.find((function(t){return t.combinedName===c}))&&(O="collision"),r.find((function(t){return t.combinedName===c}))||(r.push({combinedName:c,collision:!0}),B.collisionEvents.emit("collision",{bodies:[g,w],event:O}))}return n>=C&&(C=n,(x||A)&&(B.impactPoint.set(i.x(),i.y(),i.z()),B.impactNormal.set(s.x(),s.y(),s.z()))),"break"}},B=this,E=0,T=p.getNumContacts();E<T;E++){if("break"===M(E))break}if(P&&(x||A)){if(this.emptyV3.set(0,0,0),g.userData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:x,physicsBody:f},w.userData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:A,physicsBody:y},void 0===g.fragmentDepth&&(g.fragmentDepth=0),void 0===w.fragmentDepth&&(w.fragmentDepth=0),x&&C>5&&g.fragmentDepth<2){var j=(z=this.convexBreaker.subdivideByImpact(g,this.impactPoint,this.impactNormal,1,2)).length;for(E=0;E<j;E++){var S=f.getLinearVelocity(),k=f.getAngularVelocity();(D=z[E]).userData.velocity.set(S.x(),S.y(),S.z()),D.userData.angularVelocity.set(k.x(),k.y(),k.z()),this.createDebrisFromBreakableObject(D,g)}this.objectsToRemove[this.numObjectsToRemove++]=g}if(A&&C>5&&w.fragmentDepth<2){var z;for(j=(z=this.convexBreaker.subdivideByImpact(w,this.impactPoint,this.impactNormal,1,2)).length,E=0;E<j;E++){var D;S=y.getLinearVelocity(),k=y.getAngularVelocity();(D=z[E]).userData.velocity.set(S.x(),S.y(),S.z()),D.userData.angularVelocity.set(k.x(),k.y(),k.z()),this.createDebrisFromBreakableObject(D,w)}this.objectsToRemove[this.numObjectsToRemove++]=w}}}}}}for(s=0;s<this.numObjectsToRemove;s++)this.removeDebris(this.objectsToRemove[s]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach((function(t){var e=t.combinedName;if(!r.find((function(t){return t.combinedName===e}))){var o=e.split("__"),i=n.rigidBodies.find((function(t){return t.name===o[0]})),s=n.rigidBodies.find((function(t){return t.name===o[1]}));i&&s&&n.collisionEvents.emit("collision",{bodies:[i,s],event:"end"})}})),this.earlierDetectedCollisions=wt(r)},e.prototype.setGravity=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=-9.8),void 0===o&&(o=0),this.tmpBtVector3.setValue(t,e,o),this.physicsWorld.setGravity(this.tmpBtVector3)},Object.defineProperty(e.prototype,"debug",{get:function(){var t=this;return this.isHeadless?null:{enable:function(){t.debugDrawer.enable()},mode:function(e){void 0===e&&(e=1),t.debugDrawer.setDebugMode(e)},disable:function(){t.debugDrawer.disable()}}},enumerable:!0,configurable:!0}),e.prototype.start=function(){var t=this;"undefined"!=typeof Ammo?"function"==typeof Ammo?Ammo().then((function(){t.setup()})):this.setup():r()("Are you sure you included ammo.js?")},Object.defineProperty(e.prototype,"add",{get:function(){var t=this;return{collider:function(e,o,n){return t.collisionEvents.addCollider(e,o,n)},constraints:this.constraints.addConstraints,existing:function(e,o){return t.addExisting(e,o)},plane:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.shapes.addPlane(e,o)},sphere:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.shapes.addSphere(e,o)},ground:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.shapes.addGround(e,o)},box:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.shapes.addBox(e,o)},cylinder:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.shapes.addCylinder(e,o)},cone:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.shapes.addCone(e,o)},torus:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.shapes.addTorus(e,o)},extrude:function(e,o){return void 0===o&&(o={}),t.shapes.addExtrude(e,o)},raycaster:function(e){return void 0===e&&(e="closest"),"closest"===e?new ft(t):new yt(t)}}},enumerable:!0,configurable:!0}),e.prototype.prepareThreeObjectForCollisionShape=function(t,e){var o,n;void 0===e&&(e={});t.position,t.quaternion,t.hasBody;var i=e.autoCenter,s=void 0!==i&&i,a={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6},c="unknown",u=(null===(o=t.geometry)||void 0===o?void 0:o.type)||"unknown";/box/i.test(u)?c="box":/cone/i.test(u)?c="cone":/cylinder/i.test(u)?c="cylinder":/extrude/i.test(u)?c="extrude":/plane/i.test(u)?c="plane":/sphere/i.test(u)?c="sphere":/torus/i.test(u)&&(c="torus");var l=gt(gt({},a),null===(n=null==t?void 0:t.geometry)||void 0===n?void 0:n.parameters);return e.shape?(l=gt(gt({},a),e),c=e.shape):t.shape&&(c=t.shape),Object.keys(l).forEach((function(t){void 0===l[t]&&a[t]&&(l[t]=a[t])})),s&&t.geometry.center(),"extrude"===c&&(c="hacd"),"mesh"!==c&&"convex"!==c||(c="convexMesh"),"concave"===c&&(c="concaveMesh"),"unknown"===c&&(r()("Shape for "+(null==t?void 0:t.name)+" not recognized! Will fallback to box."),c="box"),{shape:c,params:l,object:t}},e.prototype.createCollisionShape=function(t,e,o){var n,r=(null==o?void 0:o.quaternion)?null==o?void 0:o.quaternion:new v.Quaternion(0,0,0,1);switch(t){case"box":n=new Ammo.btBoxShape(new Ammo.btVector3(e.width/2,e.height/2,e.depth/2));break;case"sphere":n=new Ammo.btSphereShape(e.radius);break;case"cylinder":n=new Ammo.btCylinderShape(new Ammo.btVector3(e.radiusTop,e.height/2,0));break;case"cone":n=new Ammo.btConeShape(e.radius,e.height);break;case"torus":n=function(t,e){var o=t.radius,n=void 0===o?1:o,r=t.tube,i=void 0===r?.4:r,s=t.tubularSegments,a=void 0===s?8:s,c=Math.PI,u=a,l=Math.sqrt(2*i*i-2*i*i*Math.cos(2*c/u)),m=new Ammo.btVector3(i,c/u+.5*l,i),d=new Ammo.btCylinderShape(m);d.setMargin(.05);for(var p=new Ammo.btCompoundShape,h=new Ammo.btVector3(0,0,1),f=new Ammo.btVector3(0,n,0),y=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),v=0;v<u;v++){var b=2*v*c/u,g=f.rotate(h,b),w=new Ammo.btTransform;y.setRotation(h,b+Math.PI/2),w.setIdentity(),w.setOrigin(g),w.setRotation(y),p.addChildShape(w,d)}return p}(e,r);break;case"capsule":n=new Ammo.btCapsuleShape(e.radius,e.height);break;case"plane":n=T(o,{type:"mesh",concave:!1});break;case"hull":n=T(o,{type:"hull"});break;case"hacd":n=T(o,{type:"hacd"});break;case"vhacd":n=T(o,{type:"vhacd"});break;case"convexMesh":n=T(o,{type:"mesh",concave:!1});break;case"concaveMesh":n=T(o,{type:"mesh",concave:!0})}var i=e.x,s=e.y,a=e.z;return(i||s||a)&&(n.offset={x:i||0,y:s||0,z:a||0}),Array.isArray(n)&&(n=this.mergeCollisionShapesToCompoundShape(n)),n},e.prototype.mergeCollisionShapesToCompoundShape=function(t){var e=new Ammo.btCompoundShape;return t.forEach((function(t){var o=t.offset,n=new Ammo.btTransform;n.setIdentity(),o&&n.setOrigin(new Ammo.btVector3(o.x||0,o.y||0,o.z||0)),e.addChildShape(n,t)})),e},e.prototype.addExisting=function(t,e){var o=this;if(void 0===e&&(e={}),t.hasBody)console.warn('[Enable3d]: Object "'+t.name+'" already has a physical body!');else{var n=t.position,r=t.quaternion,i=e.shape,s=void 0===i?"unknown":i,a=e.compound,c=void 0===a?[]:a,u=e.mass,l=void 0===u?1:u,m=e.collisionFlags,d=void 0===m?0:m,p=e.offset,h=void 0===p?void 0:p,f=e.breakable,y=void 0!==f&&f,v=e.addChildren,b=void 0===v||v;if(c.length>=1){var g=c.map((function(t){return o.createCollisionShape(t.shape,t)})),w=this.mergeCollisionShapesToCompoundShape(g),x=this.collisionShapeToRigidBody(w,t.position,t.quaternion,1);this.addRigidBodyToWorld(t,x)}else{var A=[];if("unknown"!==s||t.isMesh){var _=this.prepareThreeObjectForCollisionShape(t,e),V=this.createCollisionShape(_.shape,_.params,_.object);A.push(V)}if("unknown"===s&&b&&t.children.length>=1&&t.children.forEach((function(t){if(t.isMesh){var e=o.prepareThreeObjectForCollisionShape(t),n=o.createCollisionShape(e.shape,e.params,e.object);n.offset=t.position.clone(),A.push(n)}})),0===A.length){_=this.prepareThreeObjectForCollisionShape(t,e),V=this.createCollisionShape(_.shape,_.params,_.object);A.push(V)}var P=1===A.length?A[0]:this.mergeCollisionShapesToCompoundShape(A),C=this.collisionShapeToRigidBody(P,n,r,l);this.addRigidBodyToWorld(t,C,d,y,h)}}},e.prototype.addRigidBodyToWorld=function(t,e,o,n,r){void 0===o&&(o=0),this.rigidBodies.push(t),this.physicsWorld.addRigidBody(e);var i=Object.values(e)[0];e.name=t.name,t.body=new s.a(this,e),t.hasBody=!0,t.ptr=i,this.objectsAmmo[i]=t,n&&(t.body.breakable=!0),r&&(t.body.offset=gt({x:0,y:0,z:0},r)),t.body.setCollisionFlags(o)},e.prototype.collisionShapeToRigidBody=function(t,e,o,n){void 0===n&&(n=1);var r=new Ammo.btTransform;r.setIdentity(),r.setOrigin(new Ammo.btVector3(e.x,e.y,e.z)),r.setRotation(new Ammo.btQuaternion(o.x,o.y,o.z,o.w));var i=new Ammo.btDefaultMotionState(r),s=new Ammo.btVector3(0,0,0);n>0&&t.calculateLocalInertia(n,s);var a=new Ammo.btRigidBodyConstructionInfo(n,i,t,s),c=new Ammo.btRigidBody(a);return n>0&&c.setActivationState(4),c},e}(y.a);
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */}])}));
//# sourceMappingURL=enable3d.ammoPhysics.0.19.1.min.js.map